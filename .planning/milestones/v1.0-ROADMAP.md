# Roadmap Archive: kubectl-fields v1.0

*Archived: 2026-02-08*
*Milestone: v1.0 -- Full kubectl-fields implementation*

## Overview

Built a kubectl plugin that annotates Kubernetes YAML with field ownership comments, delivered in four phases: parsing infrastructure with round-trip fidelity validation, the core annotation engine (parallel descent algorithm matching FieldsV1 trees to YAML nodes), output polish with color and alignment, and extended filtering/display flags.

## Phases

### Phase 1: Foundation + Input Pipeline (2 plans, 12m 31s)
**Goal**: Parse stdin YAML, extract and strip managedFields, validate round-trip fidelity

- 01-01: Go project scaffold, YAML parser with multi-doc/List kind, round-trip fidelity tests
- 01-02: ManagedFields extraction, FieldsV1 prefix parsing, time formatter, stripping, CLI wiring

**Accomplishments**:
- Go module with yaml/v3, cobra, testify dependencies
- Perfect round-trip fidelity with all kubectl-style YAML fixtures
- Multi-doc and List kind support
- ManagedFields extraction and stripping pipeline
- Stderr warning for missing managedFields
- 35 tests across 3 packages

### Phase 2: Annotation Engine (2 plans, 9m 49s)
**Goal**: Parallel descent algorithm matching FieldsV1 ownership to YAML nodes with comment injection

- 02-01: Walker with f: field matching and comment injection (inline + above modes)
- 02-02: List item matching (k: associative keys, v: set values) and CLI wiring

**Accomplishments**:
- walkFieldsV1 parallel descent matching FieldsV1 to YAML trees
- All four FieldsV1 prefix types: f: (field), . (dot), k: (associative key), v: (set value)
- Two-pass collect-then-inject annotation architecture
- Inline and above comment placement modes
- Multi-field associative key matching (e.g., containerPort+protocol)
- Golden file tests for both modes
- 55 tests across all packages

### Phase 3: Output Polish + Color (2 plans, 8m 41s)
**Goal**: Color system, comment alignment, timestamp/display flags

- 03-01: Two-unit time formatting, output package (color manager, alignment, formatter)
- 03-02: CLI flags (--color, --mtime), x/term TTY detection, pipeline integration

**Accomplishments**:
- Two-unit relative time formatting with weeks (e.g., "5d12h ago", "2w3d ago")
- MtimeMode: relative/absolute/hide
- 8-color bright ANSI palette with round-robin assignment
- Per-block comment alignment with outlier ejection (40-char threshold)
- TTY detection with --color auto/always/never
- NO_COLOR env var support
- 85 tests across all packages

### Phase 4: Extended Features (1 plan, 3m 37s)
**Goal**: Operation type display via --show-operation flag

- 04-01: Operation field, formatComment extension, CLI flag, golden files

**Accomplishments**:
- --show-operation flag for Apply/Update display in annotations
- Operation string lowercased for consistent display
- Graceful fallback for empty operation
- All MtimeMode combinations supported

## UAT Results

10 user acceptance tests performed. 7 passed initially, 3 issues found and fixed:
1. Color distinctness: Replaced FNV-1a hash with round-robin assignment
2. Alignment outliers: Added outlier-aware block splitting (40-char threshold)
3. Cosmetic: Orange warning color, correct help invocation name

## Performance Summary

| Phase | Plans | Total | Avg/Plan |
|-------|-------|-------|----------|
| 1. Foundation + Input Pipeline | 2/2 | 12m 31s | 6m 16s |
| 2. Annotation Engine | 2/2 | 9m 49s | 4m 55s |
| 3. Output Polish + Color | 2/2 | 8m 41s | 4m 21s |
| 4. Extended Features | 1/1 | 3m 37s | 3m 37s |
| **Total** | **7/7** | **34m 38s** | **4m 39s** |

## Descoped Requirements

- REQ-021 (Manager Name Shortening, P2) -- deferred to future milestone
- REQ-023 (--managers Filter, P2) -- deferred to future milestone
